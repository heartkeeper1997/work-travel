<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ประกาศการเดินทางไปเชียงใหม่ - Vote</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Kanit', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .poster {
            /* From fixed width to responsive width */
            width: 100%;
            max-width: 800px; 
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            overflow: hidden;
            position: relative;
        }
        
        .header {
            background: linear-gradient(135deg, #ff6b6b, #ffa726);
            padding: 30px;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="80" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="70" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="70" cy="30" r="1.5" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
            animation: float 20s infinite linear;
        }
        
        @keyframes float {
            0% { transform: translateX(-50px) translateY(-50px); }
            100% { transform: translateX(0px) translateY(0px); }
        }
        
        .title {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
            position: relative;
            z-index: 2;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            font-size: 1.2em;
            font-weight: 400;
            opacity: 0.9;
            position: relative;
            z-index: 2;
        }
        
        .map-container {
            height: 300px;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            position: relative;
            overflow: hidden;
        }
        
        .thailand-map {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 300"><defs><linearGradient id="mapGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:%2364b5f6;stop-opacity:0.3" /><stop offset="100%" style="stop-color:%231976d2;stop-opacity:0.1" /></linearGradient></defs><path d="M200 50 L300 30 L400 40 L450 60 L480 100 L460 150 L440 200 L400 250 L350 260 L300 250 L250 240 L200 220 L180 180 L170 140 L180 100 Z" fill="url(%23mapGrad)" stroke="%231976d2" stroke-width="2" opacity="0.7"/></svg>') center/contain no-repeat;
        }
        
        .route-line {
            position: absolute;
            top: 50%;
            left: 25%;
            width: 50%;
            height: 4px;
            background: linear-gradient(90deg, #ff6b6b, #ffa726);
            border-radius: 2px;
            transform: translateY(-50%);
            box-shadow: 0 2px 10px rgba(255, 107, 107, 0.4);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .city {
            position: absolute;
            background: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border: 3px solid #ff6b6b;
        }
        
        .city.bangkok {
            bottom: 30%;
            left: 20%;
            background: #ff6b6b;
            color: white;
        }
        
        .city.chiangmai {
            top: 30%;
            right: 20%;
            background: #ffa726;
            color: white;
        }
        
        .car {
            position: absolute;
            top: calc(50% - 15px);
            font-size: 30px;
            animation: drive 4s infinite linear;
            z-index: 10;
        }
        
        @keyframes drive {
            0% { 
                left: 20%; 
                transform: translateX(-50%);
            }
            100% { 
                left: 70%; 
                transform: translateX(-50%);
            }
        }
        
        .content {
            padding: 40px;
            background: white;
        }
        
        .travel-dates {
            background: linear-gradient(135deg, #f8f9ff, #e8f0ff);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #ff6b6b;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        
        .dates-title {
            font-size: 1.5em;
            font-weight: 600;
            color: #ff6b6b;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .dates-info {
            font-size: 1.3em;
            color: #333;
            font-weight: 500;
        }
        
        .vote-section {
            background: linear-gradient(135deg, #fff8e1, #ffecb3);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            border: 3px solid #ffa726;
            box-shadow: 0 8px 25px rgba(255, 167, 38, 0.15);
        }
        
        .vote-title {
            text-align: center;
            font-size: 1.8em;
            font-weight: 700;
            color: #e65100;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .vote-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .name-input {
            padding: 15px 20px;
            border: 3px solid #ffa726;
            border-radius: 15px;
            font-size: 1.1em;
            font-family: 'Kanit', sans-serif;
            background: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        
        .name-input:focus {
            outline: none;
            border-color: #ff6b6b;
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.2);
            transform: translateY(-2px);
        }
        
        .vote-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
        }
        
        .vote-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 20px;
            font-size: 1.3em;
            font-weight: 600;
            font-family: 'Kanit', sans-serif;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            min-width: 150px;
        }
        
        .vote-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.5s ease;
        }
        
        .vote-btn:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .vote-yes {
            background: linear-gradient(135deg, #4caf50, #66bb6a);
            color: white;
        }
        
        .vote-yes:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 30px rgba(76, 175, 80, 0.4);
        }
        
        .vote-no {
            background: linear-gradient(135deg, #f44336, #ef5350);
            color: white;
        }
        
        .vote-no:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 30px rgba(244, 67, 54, 0.4);
        }
        
        .vote-btn:active {
            transform: translateY(-1px) scale(0.98);
        }
        
        .vote-results {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border: 2px solid #e0e0e0;
        }
        
        .results-title {
            text-align: center;
            font-size: 1.5em;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .stats-container {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-box {
            flex: 1;
            text-align: center;
            padding: 15px;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }
        
        .stat-yes {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
            border: 2px solid #4caf50;
        }
        
        .stat-no {
            background: linear-gradient(135deg, #ffebee, #ffcdd2);
            border: 2px solid #f44336;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-yes .stat-number {
            color: #2e7d32;
        }
        
        .stat-no .stat-number {
            color: #c62828;
        }
        
        .stat-label {
            font-weight: 600;
            font-size: 1.1em;
        }
        
        .voter-list {
            max-height: 200px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
        }
        
        .voter-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
            animation: slideIn 0.5s ease;
        }
        
        .voter-item:last-child {
            border-bottom: none;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .voter-name {
            font-weight: 500;
            color: #333;
        }
        
        .voter-status {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: 600;
        }
        
        .status-yes {
            background: #4caf50;
            color: white;
        }
        
        .status-no {
            background: #f44336;
            color: white;
        }
        
        .success-message {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
            color: #2e7d32;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 600;
            border: 2px solid #4caf50;
            animation: successPulse 1s ease;
        }
        
        @keyframes successPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        .notes {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid #6c757d;
            margin-top: 30px;
        }
        
        .notes-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #495057;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .note-item {
            margin-bottom: 12px;
            padding-left: 20px;
            position: relative;
            line-height: 1.6;
            color: #6c757d;
        }
        
        .note-item::before {
            content: '•';
            position: absolute;
            left: 0;
            color: #ffa726;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .decorative-elements {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            overflow: hidden;
        }
        
        .cloud {
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 100px;
            opacity: 0.6;
            animation: drift 15s infinite linear;
        }
        
        .cloud1 {
            width: 60px;
            height: 30px;
            top: 20%;
            left: -60px;
            animation-duration: 20s;
        }
        
        .cloud2 {
            width: 40px;
            height: 20px;
            top: 40%;
            left: -40px;
            animation-duration: 25s;
        }
        
        @keyframes drift {
            from { transform: translateX(0); }
            to { transform: translateX(860px); }
        }
        
        .voter-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .voter-list::-webkit-scrollbar-track {
            background: #e0e0e0;
            border-radius: 3px;
        }
        
        .voter-list::-webkit-scrollbar-thumb {
            background: #ffa726;
            border-radius: 3px;
        }

        /* --- Responsive Styles --- */
        @media (max-width: 820px) {
            body {
                padding: 0;
                align-items: flex-start;
            }
            .poster {
                width: 100%;
                border-radius: 0;
                box-shadow: none;
            }
            .content {
                padding: 20px;
            }
            .header {
                padding: 25px 20px;
            }
            .title {
                font-size: 2em;
            }
            .subtitle {
                font-size: 1.1em;
            }
            .map-container {
                height: 250px;
            }
        }

        @media (max-width: 600px) {
            .vote-buttons {
                flex-direction: column;
            }
            .vote-btn {
                width: 100%;
            }
            .stats-container {
                flex-direction: column;
            }
            .dates-info {
                font-size: 1.1em;
            }
            .vote-title {
                font-size: 1.5em;
            }
            .results-title, .dates-title {
                font-size: 1.3em;
            }
            .city {
                padding: 6px 12px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div class="poster">
        <div class="header">
            <h1 class="title">🧳 ประกาศการเดินทางไปทำงาน</h1>
            <p class="subtitle">เชียงใหม่</p>
        </div>
        
        <div class="map-container">
            <div class="thailand-map"></div>
            <div class="route-line"></div>
            <div class="city bangkok">🏢 กรุงเทพฯ</div>
            <div class="city chiangmai">🏔️ เชียงใหม่</div>
            <div class="car">🚗</div>
            
            <div class="decorative-elements">
                <div class="cloud cloud1"></div>
                <div class="cloud cloud2"></div>
            </div>
        </div>
        
        <div class="content">
            <div class="travel-dates">
                <div class="dates-title">
                    📅 กำหนดการเดินทาง
                </div>
                <div class="dates-info">
                    กรุงเทพฯ → เชียงใหม่<br>
                    <strong>วันที่ 25 ตุลาคม – 1 พฤศจิกายน 2568</strong>
                </div>
            </div>
            
            <div class="vote-section">
                <div class="vote-title">
                    🗳️ ลงชื่อเข้าร่วมการเดินทาง
                </div>
                
                <div id="successMessage" class="success-message" style="display: none;">
                    ✅ ลงชื่อเรียบร้อยแล้ว ขอบคุณครับ!
                </div>
                
                <div class="vote-form">
                    <input type="text" id="voterName" class="name-input" placeholder="กรุณากรอกชื่อ-นามสกุล" maxlength="50">
                    <div class="vote-buttons">
                        <button class="vote-btn vote-yes" onclick="vote('yes')">
                            ✈️ ไป
                        </button>
                        <button class="vote-btn vote-no" onclick="vote('no')">
                            🏠 ไม่ไป
                        </button>
                    </div>
                </div>
                
                <div class="vote-results">
                    <div class="results-title">
                        📊 สถิติการลงชื่อ
                    </div>
                    <div class="stats-container">
                        <div class="stat-box stat-yes">
                            <div class="stat-number" id="yesCount">0</div>
                            <div class="stat-label">คน ไป</div>
                        </div>
                        <div class="stat-box stat-no">
                            <div class="stat-number" id="noCount">0</div>
                            <div class="stat-label">คน ไม่ไป</div>
                        </div>
                    </div>
                    <div class="voter-list" id="voterList">
                        <div style="text-align: center; color: #999; font-style: italic;">
                            กำลังโหลดข้อมูล...
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="notes">
                <div class="notes-title">
                    📋 หมายเหตุ
                </div>
                <div class="note-item">
                    ผู้ที่เริ่มเดินทางภายหลังวันที่ 25 ตุลาคม หรือผู้ใดที่ประสงค์กลับก่อน กรุณาวางแผนการเดินทางไป–กลับด้วยตนเอง
                </div>
                <div class="note-item">
                    ผู้ที่จะเดินทาง ขอความกรุณา ขออนุญาตหัวหน้าก่อน
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK Scripts (Add these before your script tag) -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        // =========================================================================
        // TODO: วาง firebaseConfig ของคุณที่นี่ (YOUR FIREBASE CONFIG HERE)
        // =========================================================================
        const firebaseConfig = {
            apiKey: "AIza...",
            authDomain: "your-project-id.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project-id.appspot.com",
            messagingSenderId: "...",
            appId: "..."
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- โค้ดส่วนจัดการข้อมูล ---
        
        let voters = []; // Local cache to store voter data
        const votesCollection = collection(db, 'chiangmai-trip-votes');

        // Real-time listener for vote changes
        onSnapshot(votesCollection, (snapshot) => {
            voters = [];
            snapshot.forEach((doc) => {
                voters.push({ id: doc.id, ...doc.data() });
            });
            console.log("Data updated from Firestore:", voters);
            updateResults(); // Update UI whenever data changes
        });

        // ทำให้ฟังก์ชัน vote พร้อมใช้งานใน HTML
        window.vote = async function(choice) {
            const nameInput = document.getElementById('voterName');
            const name = nameInput.value.trim();
            
            if (!name) {
                alert('กรุณากรอกชื่อก่อนลงคะแนน');
                nameInput.focus();
                return;
            }
            
            // Check for duplicates in the local cache (which is always up-to-date)
            const existingVoter = voters.find(voter => voter.name.toLowerCase() === name.toLowerCase());
            if (existingVoter) {
                alert('ชื่อนี้เคยลงคะแนนแล้ว');
                return;
            }
            
            try {
                // Add a new document with a generated id.
                await addDoc(votesCollection, {
                    name: name,
                    choice: choice,
                    timestamp: serverTimestamp() // Use server timestamp for consistency
                });
                
                showSuccessMessage();
                nameInput.value = '';

            } catch (e) {
                console.error("Error adding document: ", e);
                alert("เกิดข้อผิดพลาดในการบันทึกข้อมูล!");
            }
        }
        
        function showSuccessMessage() {
            const successMessage = document.getElementById('successMessage');
            successMessage.style.display = 'block';
            
            setTimeout(() => {
                successMessage.style.display = 'none';
            }, 3000);
        }
        
        function updateResults() {
            const yesVotes = voters.filter(voter => voter.choice === 'yes').length;
            const noVotes = voters.filter(voter => voter.choice === 'no').length;
            
            document.getElementById('yesCount').textContent = yesVotes;
            document.getElementById('noCount').textContent = noVotes;
            
            updateVoterList();
        }
        
        function updateVoterList() {
            const voterList = document.getElementById('voterList');
            
            if (voters.length === 0) {
                voterList.innerHTML = '<div style="text-align: center; color: #999; font-style: italic;">ยังไม่มีผู้ลงชื่อ</div>';
                return;
            }
            
            // Sort by timestamp, newest first. Note: Firestore timestamp is an object.
            const sortedVoters = voters.sort((a, b) => {
                const timeA = a.timestamp ? a.timestamp.toMillis() : 0;
                const timeB = b.timestamp ? b.timestamp.toMillis() : 0;
                return timeB - timeA;
            });

            const voterHTML = sortedVoters
                .map(voter => {
                    const statusClass = voter.choice === 'yes' ? 'status-yes' : 'status-no';
                    const statusText = voter.choice === 'yes' ? 'ไป' : 'ไม่ไป';
                    const statusIcon = voter.choice === 'yes' ? '✈️' : '🏠';
                    
                    return `
                        <div class="voter-item">
                            <div class="voter-name">${voter.name}</div>
                            <div class="voter-status ${statusClass}">
                                ${statusIcon} ${statusText}
                            </div>
                        </div>
                    `;
                })
                .join('');
            
            voterList.innerHTML = voterHTML;
        }
        
        // Handle Enter key press
        document.getElementById('voterName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                // Do nothing by default on Enter, user must click a button
            }
        });
    </script>
</body>
</html>

